(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[52],{3637:function(e,s,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/fibonacci-backend-web/backend-web-hpa",function(){return n(7674)}])},7674:function(e,s,n){"use strict";n.r(s),n.d(s,{__toc:function(){return a},default:function(){return d}});var i=n(5893),r=n(2673),c=n(373),l=n(8426);n(9128);var o=n(2643),t={src:"/docs-fibonacci-backend/_next/static/media/1.be92d121.png",height:1362,width:1119,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAICAMAAAAC2hU0AAAAS1BMVEX6+vr5+fr5+fn4+Pj39/f29vb19fX09PPz8/Xz8/Pz8/Lz8u/x8fLx8fHx8fDx8PDw8PDv7/Hv7/Dw8Ojt7e3t7ezr6+vr6+bo6NojZZ0IAAAAOUlEQVR42g3HRxLAIBDEwLHGOOcA/P+lrC6q1j/jSHmPg56pA6y1jEOi11uX5PB2C4yODzt8XrJxAzGnAXs4KW1nAAAAAElFTkSuQmCC",blurWidth:7,blurHeight:8};let a=[{depth:2,value:"HPA 정의 및 테스트, 모니터링",id:"hpa-정의-및-테스트-모니터링"},{depth:2,value:"시나리오",id:"시나리오"},{depth:2,value:"metrics-server 설치",id:"metrics-server-설치"},{depth:2,value:"fibonacci-backend-web 에 지연이 발생하는 코드를 추가",id:"fibonacci-backend-web-에-지연이-발생하는-코드를-추가"},{depth:2,value:"spring boot 톰캣 스레드 풀 사이즈 수정",id:"spring-boot-톰캣-스레드-풀-사이즈-수정"},{depth:2,value:"requests, limits 수정",id:"requests-limits-수정"},{depth:2,value:"낮춘 서버 사양에 맞도록 각 프로브의 initialDelaySeconds 수정",id:"낮춘-서버-사양에-맞도록-각-프로브의-initialdelayseconds-수정"}];function _createMdxContent(e){let s=Object.assign({h2:"h2",blockquote:"blockquote",p:"p",ul:"ul",li:"li",code:"code",a:"a",pre:"pre",span:"span",img:"img"},(0,o.a)(),e.components);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.h2,{id:"hpa-정의-및-테스트-모니터링",children:"HPA 정의 및 테스트, 모니터링"}),"\n",(0,i.jsxs)(s.blockquote,{children:["\n",(0,i.jsxs)(s.p,{children:["귀찮고 손이 많이 가는 문서작업이어서 건너뛰려 했는데 결국은 했어야 할 문서작업이었군!!! 하는 생각이 들어서 정리를 시작!! 합니다.",(0,i.jsx)("br",{}),"\r\nProbe 개념정리와 함께 제일 정리하기 귀찮다고 생각했던 개념을 오늘에서야!!! 정리를 시작하네요.",(0,i.jsx)("br",{})]}),"\n"]}),"\n",(0,i.jsx)("br",{}),"\n",(0,i.jsx)(s.h2,{id:"시나리오",children:"시나리오"}),"\n",(0,i.jsxs)(s.p,{children:["HPA 가 잘 적용되는지 테스트를 해보는 테스트 시나리오는 아래와 같습니다. 꼭 HPA 의 동작을 확인한 후에는 다시 정상으로 돌려두어야 합니다.",(0,i.jsx)("br",{})]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"fibonacci-backend-web"})," 내에서 fibonacci 계산을 수행하는 함수에 500ms 의 delay 를 부여합니다. 이렇게 해서 1초에 약 2번 정도 연산을 수행할 수 있는 상황을 가정합니다."]}),"\n",(0,i.jsxs)(s.li,{children:["테스트를 위해 ",(0,i.jsx)(s.code,{children:"generate-load-request.sh"})," 에서는 1초에 50개의 request 를 보내는데 ",(0,i.jsx)(s.a,{href:"http://localhost:8080/number=1",children:"http://localhost:8080/number=1"})," 을 단순 GET 요청으로 보냅니다.","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"듣기에는 어려운 방식처럼 보이지만, for 문 내에 1초의 delay 를 걸고 delay 이전 구문에서 50번의 curl 요청을 for loop 으로 수행하는 방식을 무한 루프로 돌리는 간단한 방식입니다. 이 글의 하단에서 정리를 합니다."}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.li,{children:"오토스케일링 테스트를 위해 readinessProbe, livenessProbe 를 통해 파드의 재시동 주기를 조절합니다. 가급적 재시동이 자주 걸리지 않도록 변경해줍니다."}),"\n",(0,i.jsx)(s.li,{children:"CPU, Memory 도 조금은 작은 용량으로 준비해둡니다. 스케일링이 잘 되는지 확인해보기 위해서입니다."}),"\n",(0,i.jsx)(s.li,{children:"readiness 프로브에서는 successThreshold를 작게주어서 재기동 중에 다시 재기동이 이뤄지지 않도록 하고, failureThreshold 는 더 크게 주어서 관대하게 설정을 합니다."}),"\n",(0,i.jsx)(s.li,{children:"liveness 프로브에는 failureThreshold 를 조정해서 live 판정이 조금 더 자주 일어나지 않도록 조정합니다."}),"\n",(0,i.jsx)(s.li,{children:"재기동이 민감하지 않은 것을 확인했으면 이제는 HPA 설정을 시작합니다. minReplicas=2, maxReplicas=5 로 주어서 2~5 사이에서 스케일링이 이뤄지게끔 합니다. averageUtilization 은 50 으로 주어서 1000m * 50% 인 500m 일때 스케일링이 일어나도록 설정해줍니다. 그리고 stabilizationWindowSeconds 를 지정해서 스케일링 주기를 결정합니다."}),"\n",(0,i.jsxs)(s.li,{children:["스케일링이 이뤄지는지 ",(0,i.jsx)(s.code,{children:"generate-load-request.sh"})," 를 통해 확인해봅니다."]}),"\n"]}),"\n",(0,i.jsx)("br",{}),"\n",(0,i.jsx)(s.h2,{id:"metrics-server-설치",children:"metrics-server 설치"}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.a,{href:"https://github.com/kubernetes-sigs/metrics-server",children:(0,i.jsx)(s.code,{children:"metrics-server"})})," 는 k8s 플랫폼마다 기본으로 설치된 곳도 있고 아닌 플랫폼도 있습니다. 로컬 클러스터인 ",(0,i.jsxs)(s.a,{href:"https://kind.sigs.k8s.io/",children:[(0,i.jsx)(s.code,{children:"kind"})," 클러스터"]}),"에서도 설치가 되어있는지 확인이 필요합니다.",(0,i.jsx)("br",{})]}),"\n",(0,i.jsxs)(s.p,{children:["클러스터 내에 ",(0,i.jsx)(s.code,{children:"metrics-server"}),"가 설치되었는지 확인을 합니다."]}),"\n",(0,i.jsx)(s.pre,{"data-language":"bash","data-theme":"default",filename:"bash",hasCopyCode:!0,children:(0,i.jsxs)(s.code,{"data-language":"bash","data-theme":"default",children:[(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"$"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"kubectl"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"top"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"nodes"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"error:"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"Metrics"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"API"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"not"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"available"})]})]})}),"\n",(0,i.jsx)("br",{}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"metrics-server"})," 가 설치되어 있지 않습니다. ",(0,i.jsx)(s.a,{href:"https://github.com/kubernetes-sigs/metrics-server",children:(0,i.jsx)(s.code,{children:"metrics-server"})})," 에 방문해서 ",(0,i.jsx)(s.code,{children:"metrics-server"}),"를 설치합니다.",(0,i.jsx)("br",{})]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.a,{href:"https://github.com/kubernetes-sigs/metrics-server?tab=readme-ov-file#installation",children:"metrics-server#installation"}),"에서는 metrics-server 를 설치하는 명령어를 알려주고 있습니다. 이 명령어를 복사해서 쿠버네티스 클러스터에 적용해줍니다.",(0,i.jsx)("br",{})]}),"\n",(0,i.jsx)(s.pre,{"data-language":"bash","data-theme":"default",filename:"bash",hasCopyCode:!0,children:(0,i.jsx)(s.code,{"data-language":"bash","data-theme":"default",children:(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"kubectl"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"apply"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"-f"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml"})]})})}),"\n",(0,i.jsx)("br",{}),"\n",(0,i.jsxs)(s.p,{children:["이렇게 설치를 해도 아래와 같이 ",(0,i.jsx)(s.code,{children:"kubectl top nodes"})," 로 현황을 확인해도 에러 메시지가 나타나는 경우가 있습니다."]}),"\n",(0,i.jsx)(s.pre,{"data-language":"bash","data-theme":"default",filename:"bash",hasCopyCode:!0,children:(0,i.jsxs)(s.code,{"data-language":"bash","data-theme":"default",children:[(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"$"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"kubectl"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"top"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"nodes"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"error:"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"Metrics"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"API"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"not"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"available"})]})]})}),"\n",(0,i.jsx)("br",{}),"\n",(0,i.jsx)(s.p,{children:"이 경우 아래와 같이 metrics-server 라는 이름의 deployment 를 수정하는 명령어를 실행해줍니다."}),"\n",(0,i.jsx)(s.pre,{"data-language":"bash","data-theme":"default",filename:"bash",hasCopyCode:!0,children:(0,i.jsx)(s.code,{"data-language":"bash","data-theme":"default",children:(0,i.jsx)(s.span,{className:"line",children:" "})})}),"\n",(0,i.jsx)("br",{}),"\n",(0,i.jsxs)(s.p,{children:["그리고 나타나는 시스템 에디터에서는 insecure 옵션을 추가해준 후 저장합니다.\r\n",(0,i.jsx)(s.img,{placeholder:"blur",src:t})]}),"\n",(0,i.jsx)("br",{}),"\n",(0,i.jsxs)(s.p,{children:["설치가 잘 되었는지 확인해봅니다. 결과를 보니 잘 설치되었습니다. (제일 아래줄에 ",(0,i.jsx)(s.code,{children:"metrics-server-796fbd6c9d-29hdz"})," 을 확인 가능)"]}),"\n",(0,i.jsx)(s.pre,{"data-language":"bash","data-theme":"default",filename:"bash",hasCopyCode:!0,children:(0,i.jsxs)(s.code,{"data-language":"bash","data-theme":"default",children:[(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"$"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"kubectl"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"-n"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"kube-system"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"get"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"pods"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"NAME"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"                                                      "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"READY"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"STATUS"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"RESTARTS"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"AGE"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"coredns-5d78c9869d-hx9td"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"                                  "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"1"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"/1"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"     "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"Running"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"0"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"          "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"48"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"m"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"coredns-5d78c9869d-stjkw"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"                                  "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"1"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"/1"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"     "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"Running"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"0"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"          "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"48"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"m"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"etcd-fibonacci-cluster-control-plane"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"                      "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"1"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"/1"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"     "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"Running"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"0"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"          "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"48"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"m"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"kindnet-rzptz"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"                                             "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"1"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"/1"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"     "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"Running"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"0"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"          "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"48"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"m"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"kindnet-vhxbz"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"                                             "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"1"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"/1"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"     "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"Running"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"0"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"          "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"48"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"m"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"kube-apiserver-fibonacci-cluster-control-plane"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"            "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"1"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"/1"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"     "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"Running"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"0"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"          "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"48"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"m"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"kube-controller-manager-fibonacci-cluster-control-plane"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"1"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"/1"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"     "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"Running"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"0"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"          "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"48"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"m"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"kube-proxy-m46jh"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"                                          "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"1"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"/1"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"     "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"Running"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"0"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"          "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"48"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"m"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"kube-proxy-mtrtz"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"                                          "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"1"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"/1"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"     "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"Running"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"0"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"          "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"48"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"m"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"kube-scheduler-fibonacci-cluster-control-plane"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"            "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"1"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"/1"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"     "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"Running"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"0"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"          "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"48"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"m"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"metrics-server-796fbd6c9d-29hdz"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"                           "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"1"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"/1"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"     "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"Running"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"0"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"          "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"23"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"s"})]})]})}),"\n",(0,i.jsx)("br",{}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"kubectl top nodes"})," 명령을 통해 지표들이 수집되는지 확인해봅니다."]}),"\n",(0,i.jsx)(s.pre,{"data-language":"bash","data-theme":"default",filename:"bash",hasCopyCode:!0,children:(0,i.jsxs)(s.code,{"data-language":"bash","data-theme":"default",children:[(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"$"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"kubectl"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"top"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"nodes"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"NAME"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"                              "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"CPU"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"cores"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:")   "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"CPU%"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"MEMORY"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"bytes"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:")   "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"MEMORY%"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"fibonacci-cluster-control-plane"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"144"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"m"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"         "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"0"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"%"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"     "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"1213"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"Mi"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"          "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"6"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"%"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"fibonacci-cluster-worker"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"          "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"29"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"m"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"          "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"0"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"%"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"     "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"283"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"Mi"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"           "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"1"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"%"})]})]})}),"\n",(0,i.jsx)("br",{}),"\n",(0,i.jsxs)(s.h2,{id:"fibonacci-backend-web-에-지연이-발생하는-코드를-추가",children:[(0,i.jsx)(s.code,{children:"fibonacci-backend-web"})," 에 지연이 발생하는 코드를 추가"]}),"\n",(0,i.jsxs)(s.p,{children:["500ms 만큼 지연이 계속해서 발생하는 상황을 가정한 delay 코드를 추가합니다.",(0,i.jsx)("br",{})]}),"\n",(0,i.jsx)("br",{}),"\n",(0,i.jsx)(s.h2,{id:"spring-boot-톰캣-스레드-풀-사이즈-수정",children:"spring boot 톰캣 스레드 풀 사이즈 수정"}),"\n",(0,i.jsxs)(s.p,{children:["스프링 컨테이너의 커넥션을 처리하는 스레드가 부족해지는 상황을 가정하기 위해 스프링 부트 톰캣 스레드 풀의 사이즈를 10으로 수정합니다. 스프링 부트 톰캣 스레드 풀의 기본사이즈는 200 입니다.",(0,i.jsx)("br",{})]}),"\n",(0,i.jsx)("br",{}),"\n",(0,i.jsx)(s.h2,{id:"requests-limits-수정",children:"requests, limits 수정"}),"\n",(0,i.jsx)(s.p,{children:"파드의 스펙을 아래와 같이 수정해줍니다."}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["memory","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:'requests : "512Mi"'}),"\n",(0,i.jsx)(s.li,{children:'limits : "1Gi"'}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["cpu","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:'requests: "1000m"'}),"\n",(0,i.jsx)(s.li,{children:'limits: "1500m"'}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)("br",{}),"\n",(0,i.jsx)(s.pre,{"data-language":"yaml","data-theme":"default",filename:"fibonacci-backend-hpa.yaml",hasCopyCode:!0,children:(0,i.jsx)(s.code,{"data-language":"yaml","data-theme":"default",children:(0,i.jsx)(s.span,{className:"line",children:(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"추가 예정"})})})}),"\n",(0,i.jsx)("br",{}),"\n",(0,i.jsxs)(s.h2,{id:"낮춘-서버-사양에-맞도록-각-프로브의-initialdelayseconds-수정",children:["낮춘 서버 사양에 맞도록 각 프로브의 ",(0,i.jsx)(s.code,{children:"initialDelaySeconds"})," 수정"]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["서버사양을 낮춘 만큼 부팅이 늦어질 가능성이 높기 때문에 Redyness 프로브, Startup 프로브의 ",(0,i.jsx)(s.code,{children:"initialDelaySeconds"})," 를 아래와 같이 수정해줍니다."]}),"\n"]}),"\n",(0,i.jsx)("br",{})]})}let h={MDXContent:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:s}=Object.assign({},(0,o.a)(),e.components);return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(_createMdxContent,{...e})}):_createMdxContent(e)},pageOpts:{filePath:"pages/fibonacci-backend-web/backend-web-hpa.mdx",route:"/fibonacci-backend-web/backend-web-hpa",timestamp:1708584549e3,pageMap:[{kind:"Folder",name:"fibonacci-backend-cache",route:"/fibonacci-backend-cache",children:[{kind:"MdxPage",name:"backend-cache-coding",route:"/fibonacci-backend-cache/backend-cache-coding"},{kind:"MdxPage",name:"backend-cache-graceful-shutdown",route:"/fibonacci-backend-cache/backend-cache-graceful-shutdown"},{kind:"MdxPage",name:"backend-cache-jib-build",route:"/fibonacci-backend-cache/backend-cache-jib-build"},{kind:"MdxPage",name:"backend-cache-k8s-yaml",route:"/fibonacci-backend-cache/backend-cache-k8s-yaml"},{kind:"MdxPage",name:"backend-cache-kustomize",route:"/fibonacci-backend-cache/backend-cache-kustomize"},{kind:"MdxPage",name:"backend-cache-perf-test",route:"/fibonacci-backend-cache/backend-cache-perf-test"},{kind:"MdxPage",name:"introduce-fibonacci-backend-cache",route:"/fibonacci-backend-cache/introduce-fibonacci-backend-cache"},{kind:"Meta",data:{"introduce-fibonacci-backend-cache":"소개","backend-cache-coding":"Backend 코드 작업","backend-cache-jib-build":"Gradle Jib 빌드 정의, 이미지 생성, 푸시","backend-cache-k8s-yaml":"k8s 리소스 정의 & 로컬 k8s 확인","backend-cache-kustomize":"Kustomize Overlay 작업","backend-cache-graceful-shutdown":"Graceful Shutdown 처리","backend-cache-perf-test":"부하테스트"}}]},{kind:"Folder",name:"fibonacci-backend-web",route:"/fibonacci-backend-web",children:[{kind:"MdxPage",name:"backend-web-coding",route:"/fibonacci-backend-web/backend-web-coding"},{kind:"MdxPage",name:"backend-web-graceful-shutdown",route:"/fibonacci-backend-web/backend-web-graceful-shutdown"},{kind:"MdxPage",name:"backend-web-hpa",route:"/fibonacci-backend-web/backend-web-hpa"},{kind:"MdxPage",name:"backend-web-jib-build",route:"/fibonacci-backend-web/backend-web-jib-build"},{kind:"MdxPage",name:"backend-web-k8s-yaml",route:"/fibonacci-backend-web/backend-web-k8s-yaml"},{kind:"MdxPage",name:"backend-web-kustomize",route:"/fibonacci-backend-web/backend-web-kustomize"},{kind:"MdxPage",name:"backend-web-perf-test",route:"/fibonacci-backend-web/backend-web-perf-test"},{kind:"MdxPage",name:"introduce-fibonacci-backend-web",route:"/fibonacci-backend-web/introduce-fibonacci-backend-web"},{kind:"Meta",data:{"introduce-fibonacci-backend-web":"소개","backend-web-coding":"Backend 코드 작업","backend-web-jib-build":"Gradle Jib 빌드 정의, 이미지 생성, 푸시","backend-web-k8s-yaml":"k8s 리소스 정의 & 로컬 k8s 확인","backend-web-hpa.yaml":"HPA 정의 및 테스트, 모니터링","backend-web-kustomize":"Kustomize Overlay 작업","backend-web-graceful-shutdown":"Graceful Shutdown 처리","backend-web-perf-test":"부하테스트","backend-web-hpa":"Backend Web Hpa"}}]},{kind:"MdxPage",name:"index",route:"/"},{kind:"Folder",name:"kubernetes-overview",route:"/kubernetes-overview",children:[{kind:"MdxPage",name:"intro",route:"/kubernetes-overview/intro"},{kind:"MdxPage",name:"kubernetes-resource-assignment",route:"/kubernetes-overview/kubernetes-resource-assignment"},{kind:"MdxPage",name:"kubernetes-scaling",route:"/kubernetes-overview/kubernetes-scaling"},{kind:"Meta",data:{intro:"소개","kubernetes-scaling":"쿠버네티스의 스케일링","kubernetes-resource-assignment":"쿠버네티스의 자원 할당"}}]},{kind:"Folder",name:"setup",route:"/setup",children:[{kind:"MdxPage",name:"deploy-environment",route:"/setup/deploy-environment"},{kind:"MdxPage",name:"local-k8s-setup",route:"/setup/local-k8s-setup"},{kind:"MdxPage",name:"redis-environment",route:"/setup/redis-environment"},{kind:"MdxPage",name:"reference",route:"/setup/reference"},{kind:"Meta",data:{"local-k8s-setup":"로컬 k8s 셋업","deploy-environment":"배포환경","redis-environment":"레디스 환경설정",reference:"참고한 스터디 자료들"}}]},{kind:"Meta",data:{index:"Introduction",setup:"SETUP","fibonacci-backend-cache":"fibonacci-backend-cache","fibonacci-backend-web":"fibonacci-backend-web",contact:{title:"Contact ↗",type:"page",href:"-",newWindow:!0}}}],flexsearch:{codeblocks:!0},title:"Backend Web Hpa",headings:a},pageNextRoute:"/fibonacci-backend-web/backend-web-hpa",nextraLayout:c.ZP,themeConfig:l.Z};var d=(0,r.j)(h)},8426:function(e,s,n){"use strict";var i=n(5893);n(7294);let r={logo:(0,i.jsx)("span",{children:"My Project"}),project:{link:"https://github.com/chagchagchag/docs-fibonacci-backend"},docsRepositoryBase:"https://github.com/chagchagchag/docs-fibonacci-backend",footer:{text:"Nextra Docs Template"}};s.Z=r},5789:function(){}},function(e){e.O(0,[774,796,888,179],function(){return e(e.s=3637)}),_N_E=e.O()}]);